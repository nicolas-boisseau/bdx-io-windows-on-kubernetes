---
layout: image-left
# the image source
image: /start_kit/idea.jpg
---

# Idée FinOps : et si on pouvait tout mettre dans Kubernetes ?

<v-clicks>

- 1 seul Application gateway, avec Ingress Controller (AGIC)
- packaging unique (images Docker)
- tous rangés dans un registre unique 
- Pipeline CD unifié (déploiement avec Helm)
- 1 seule plateforme pour toutes nos applications

</v-clicks>

<div class="mt-5 bg-green-30 dark:bg-green-500 p-3 rounded-lg" v-click>
    <h4 class="text-sm font-bold mb-2">Gains ?</h4>
    <ul class="text-sm">
        <li>Baisse des coûts d'infra</li>
        <li>Moins de maintenance</li>
    </ul>
</div>

<!--
Notes du présentateur: Expliquer pourquoi les applications legacy Windows sont problématiques dans un environnement cloud moderne.
-->

---
layout: image-right
image: /start_kit/aks_workshop_with_microsoft.png
---

# Mise en oeuvre du projet pilote

Accompagné par Microsoft nous avons :

- testé la conteneurisation d'une application legacy Windows en local

- créé un cluster AKS avec support Windows

- déployé notre application legacy Windows dans AKS

- exposé l'application via Application Gateway avec AGIC

- testé la montée en charge des applications

- puis mis à l'échelle !

---

# POC : Dockerfile Windows

```dockerfile {all|1|3-6|8-11|13-15|17-20}
FROM mcr.microsoft.com/dotnet/framework/aspnet:4.8.1-windowsservercore-ltsc2025

# Variables d'environnement
ENV WEBSITE_NAME="LegacyApp" \
    APP_POOL_NAME="LegacyAppPool" \
    APP_POOL_IDENTITY="NetworkService"

# Installation des features IIS requises
RUN powershell -Command \
    Add-WindowsFeature Web-ASP-Net45; \
    Add-WindowsFeature Web-Windows-Auth; \
    Add-WindowsFeature Web-Http-Logging

# Copie des fichiers de l'application
COPY ./Application/ /inetpub/wwwroot/LegacyApp/
COPY ./Config/web.config /inetpub/wwwroot/LegacyApp/web.config

# Configuration d'IIS
RUN powershell -Command \
    Import-Module WebAdministration; \
    New-WebAppPool -Name $env:APP_POOL_NAME; \
    New-Website -Name $env:WEBSITE_NAME -Port 80 -PhysicalPath "C:\inetpub\wwwroot\LegacyApp" -ApplicationPool $env:APP_POOL_NAME

EXPOSE 80
```

<img src="/start_kit/bdxio-kit-communication/illustrations/highlight-orange.png" class="h-5 absolute right-10 top-20" />

---
layout: two-cols
---

# Déploiement sur AKS

<v-clicks>

- Configuration du cluster AKS
  - Control plane Linux
  - Node pools Windows et Linux
- Options de réseau
- Storage classes Windows compatibles
- Gestion des licences Windows

</v-clicks>

<div class="mt-5">
  <v-click>
```bash
# Création d'un cluster AKS avec node pool Windows
az aks create \
    --resource-group myResourceGroup \
    --name myAKSCluster \
    --node-count 1 \
    --enable-addons monitoring \
    --generate-ssh-keys

# Ajouter un node pool Windows
az aks nodepool add \
    --resource-group myResourceGroup \
    --cluster-name myAKSCluster \
    --os-type Windows \
    --name winpool \
    --node-count 1
```
  </v-click>
</div>

::right::

<div class="pl-10 pt-10">
  <v-click>
    <div class="mermaid">
```mermaid
  flowchart TB

    subgraph AKS
        subgraph "Linux Node Pool"
        cp@{ icon: "azure:kubernetes-services", label: "Control Plane" }
        linux@{ icon: "azure:kubernetes-services", label: "Linux Workloads" }
        end
        subgraph "Windows Node Pool"
        win@{ icon: "azure:kubernetes-services", label: "Windows Containers" }
        end
    end
    
    cp --> win
    cp --> linux
```
</div>
  </v-click>

  <div class="mt-10">
    <v-click>
      <div class="bg-blue-50 dark:bg-blue-900 p-3 rounded-lg">
        <h4 class="text-sm font-bold mb-2">Points d'attention</h4>
        <ul class="text-sm">
          <li>Version Windows Server de l'image = version du node</li>
          <li>Limitations des fonctionnalités réseau</li>
          <li>Taille des images (10GB+ parfois)</li>
        </ul>
      </div>
    </v-click>
  </div>
</div>

<!--
Notes du présentateur: Configuration spécifique pour AKS avec Windows, points d'attention particuliers.
-->
